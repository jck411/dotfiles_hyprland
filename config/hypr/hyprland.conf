# =============================================================================
# SOURCE CONFIGURATION FILES
# =============================================================================
# host.conf     → Machine-specific: GPU, cursor size, monitor defaults
# monitors.conf → Monitor layout (managed by nwg-displays or manual)
# workspaces.conf → Workspace rules
# quake-rules.conf → Quake terminal rules
source = ./host.conf
source = ./monitors.conf
source = ./workspaces.conf
source = ./quake-rules.conf

# Fallback for unknown/new monitors
monitor=,preferred,auto,1

# =============================================================================
# ENVIRONMENT VARIABLES - HiDPI & TOOLKIT SCALING
# =============================================================================
# Terminal
env = TERMINAL,foot

# GPU drivers set in host.conf

# Wayland backends (force native Wayland for all toolkits)
env = CLUTTER_BACKEND,wayland
env = GDK_BACKEND,wayland,x11,*
env = QT_QPA_PLATFORM,wayland;xcb
env = SDL_VIDEODRIVER,wayland
env = MOZ_ENABLE_WAYLAND,1

# Qt HiDPI settings
env = QT_AUTO_SCREEN_SCALE_FACTOR,1
env = QT_WAYLAND_DISABLE_WINDOWDECORATION,1
env = QT_QPA_PLATFORMTHEME,qt5ct

# XDG Desktop
env = XDG_SESSION_TYPE,wayland
env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_DESKTOP,Hyprland

# Cursor theme (size set in host.conf)
env = XCURSOR_THEME,Nordzy-cursors
env = HYPRCURSOR_THEME,Nordzy-cursors

# GTK Theme
env = GTK_THEME,Nordic
env = GTK_IM_MODULE,

# Electron apps (VS Code, Brave, Spotify, etc.)
env = ELECTRON_OZONE_PLATFORM_HINT,auto

# Force dark theme for all applications

# Nord Color Palette
$nord0 = 2e3440
$nord1 = 3b4252
$nord2 = 434c5e
$nord3 = 4c566a
$nord4 = d8dee9
$nord5 = e5e9f0
$nord6 = eceff4
$nord7 = 8fbcbb
$nord8 = 88c0d0
$nord9 = 81a1c1
$nord10 = 5e81ac
$nord11 = bf616a
$nord12 = d08770
$nord13 = ebcb8b
$nord14 = a3be8c
$nord15 = b48ead

# General settings
general {
    gaps_in = 5
    gaps_out = 10
    border_size = 2
    col.active_border = rgb($nord8) rgb($nord9) 45deg
    col.inactive_border = rgb($nord3)
    layout = dwindle
    resize_on_border = true
    allow_tearing = false
}

xwayland {
  # Force XWayland apps to scale themselves (prevents blurry upscaling)
  force_zero_scaling = true
}

# Cursor settings for consistent sizing
# default_monitor set in host.conf
cursor {
    no_hardware_cursors = false
}

decoration {
    rounding = 0

    blur {
        enabled = false
        size = 6
        passes = 2
        new_optimizations = true
        xray = false
    }

    shadow {
        enabled = false
    }
}

animations {
    enabled = true
    bezier = myBezier, 0.05, 0.9, 0.1, 1.05

    animation = windows, 1, 5, myBezier
    animation = windowsOut, 1, 5, default, popin 80%
    animation = border, 1, 8, default
    animation = borderangle, 1, 8, default
    animation = fade, 1, 5, default
    animation = workspaces, 1, 4, default
}

dwindle {
    pseudotile = true
    preserve_split = true
}

misc {
    force_default_wallpaper = 0
    disable_hyprland_logo = true
    disable_splash_rendering = true
    mouse_move_enables_dpms = true
    key_press_enables_dpms = true
    vrr = 0
    vfr = true
}

input {
    kb_layout = us
    follow_mouse = 1
    touchpad {
        natural_scroll = true
        disable_while_typing = true
        tap-to-click = true
        scroll_factor = 0.5
    }
    sensitivity = 0
}

# Window rules (Hyprland 0.53+ block syntax)
windowrule {
    name = rule
    match:class = ^(code-insiders)$
    workspace = 2 silent
}

windowrule {
    name = rule
    match:class = ^(spotify)$
    workspace = 4 silent
}

windowrule {
    name = rule
    match:class = ^(thunar)$
    workspace = 5 silent
}

# NetworkManager connection editor - ensure it's properly sized
windowrule {
    name = rule
    match:class = ^(nm-connection-editor)$
    float = true
    size = 600 700
    center = true
}

# nwg-displays - display settings GUI
windowrule {
    name = rule
    match:class = ^(nwg-displays)$
    float = true
    size = 900 600
    center = true
}

# Generic dialog/settings windows - ensure minimum usable size
windowrule {
    name = rule
    match:title = ^(Open File)$
    float = true
}

windowrule {
    name = rule
    match:title = ^(Save As)$
    float = true
}

windowrule {
    name = rule
    match:title = ^(Preferences)$
    float = true
}

# Waybar popup dialogs (yad) - treat as regular window
# (no special rules, will tile like other windows)

# Transparency rules (active, inactive opacity)
windowrule {
    name = rule
    match:class = ^(foot)$
    opacity = 0.95 0.85
}

windowrule {
    name = rule
    match:class = ^(thunar)$
    opacity = 0.90 0.85
}

windowrule {
    name = rule
    match:class = ^(rofi)$
    opacity = 0.90 0.85
}

# Keep browsers and editors opaque for readability
windowrule {
    name = rule
    match:class = ^(brave-browser)$
    opacity = 1.0 1.0
}

windowrule {
    name = rule
    match:class = ^(code-insiders)$
    opacity = 1.0 1.0
}

windowrule {
    name = rule
    match:class = ^(cursor)$
    opacity = 1.0 1.0
}

# Blur for layershell (waybar, notifications) - Hyprland 0.53+ syntax
# layerrule - disabled until block syntax confirmed
# layerrule = blur, namespace:waybar
# layerrule = blur, namespace:notifications

# Autostart
exec-once=xrdb -merge ~/.Xresources
exec-once=swww-daemon &
exec-once=~/.config/hypr/wallpaper.sh &
exec-once=waybar
exec-once=mako &
exec-once=brightnessctl set 80% &

# Clipboard: single watcher for both text and images (reduced from 3 watchers)
exec-once=wl-paste --watch cliphist store &

# Google Drive - optimized for faster response
# --poll-interval 0 = no polling (reduces network chatter)
# --vfs-cache-mode full = cache files locally for faster access
# --vfs-read-ahead 128M = prefetch for smoother reading
# --dir-cache-time 72h = cache directory listings longer
# --vfs-cache-max-age 72h = keep cached files longer
# exec-once=rclone mount n: /home/human/GoogleDrive --vfs-cache-mode full --vfs-read-ahead 128M --dir-cache-time 72h --vfs-cache-max-age 72h --poll-interval 0 --daemon &

# Lid switch handling
bindl=,switch:on:Lid Switch,exec,~/.config/hypr/lid-handler.sh close
bindl=,switch:off:Lid Switch,exec,~/.config/hypr/lid-handler.sh open

# Basic keybinds
bind=SUPER,Return,exec,foot
bind=SUPER,D,exec,rofi -show drun
bind=SUPER,Q,killactive,
bind=SUPER,Escape,exit,
bind=SUPER,F,fullscreen,0

# Screenshot (select region, open in swappy)
bind=SUPER,S,exec,grim -g "$(slurp)" - | swappy -f -

# Clipboard history
bind=SUPER,C,exec,cliphist list | rofi -dmenu | cliphist decode | wl-copy

# Restart Waybar (use this if Waybar disappears)
bind=SUPER,B,exec,killall waybar; waybar

# Switch to next random wallpaper
bind=SUPER,W,exec,swww img "$(find ~/Pictures/wallpapers -type f \( -name '*.png' -o -name '*.jpg' -o -name '*.jpeg' \) | shuf -n 1)" --transition-type fade --transition-duration 2

# Brightness control
binde=,XF86MonBrightnessUp,exec,brightnessctl set +5%
binde=,XF86MonBrightnessDown,exec,brightnessctl set 5%-

# Scroll through workspaces
bind=SUPER,mouse_down,workspace,e+1
bind=SUPER,mouse_up,workspace,e-1
bind=SUPER_CTRL,right,workspace,e+1
bind=SUPER_CTRL,left,workspace,e-1

# Bindings to switch between workspaces (1 to 10)
bind=SUPER,1,workspace,1
bind=SUPER,2,workspace,2
bind=SUPER,3,workspace,3
bind=SUPER,4,workspace,4
bind=SUPER,5,workspace,5
bind=SUPER,6,workspace,6
bind=SUPER,7,workspace,7
bind=SUPER,8,workspace,8
bind=SUPER,9,workspace,9
bind=SUPER,0,workspace,10

# Move focus between windows
bind=SUPER,left,movefocus,l
bind=SUPER,right,movefocus,r
bind=SUPER,up,movefocus,u
bind=SUPER,down,movefocus,d

# Vim-style focus movement
bind=SUPER,H,movefocus,l
bind=SUPER,L,movefocus,r
bind=SUPER,K,movefocus,u
bind=SUPER,J,movefocus,d

# Move active window to workspace (1 to 10)
bind=SUPER_SHIFT,1,movetoworkspace,1
bind=SUPER_SHIFT,2,movetoworkspace,2
bind=SUPER_SHIFT,3,movetoworkspace,3
bind=SUPER_SHIFT,4,movetoworkspace,4
bind=SUPER_SHIFT,5,movetoworkspace,5
bind=SUPER_SHIFT,6,movetoworkspace,6
bind=SUPER_SHIFT,7,movetoworkspace,7
bind=SUPER_SHIFT,8,movetoworkspace,8
bind=SUPER_SHIFT,9,movetoworkspace,9
bind=SUPER_SHIFT,0,movetoworkspace,10

# Cycle through windows (Alt+Tab style)
bind=ALT,Tab,cyclenext
bind=ALT SHIFT,Tab,cyclenext,prev

# Applications
bind=SUPER,E,exec,thunar
bind=SUPER,V,exec,code-insiders
bind=SUPER,P,exec,nwg-displays
bind=SUPER,G,exec,rclone mount n: /home/human/GoogleDrive --vfs-cache-mode writes --daemon && notify-send "Google Drive" "Mounted successfully"

# Quake LLM Terminal
# Swap windows within monitor (left/right)
bind=SUPER+SHIFT,H,swapwindow,l
bind=SUPER+SHIFT,L,swapwindow,r
bind=SUPER+SHIFT,K,swapwindow,u
bind=SUPER+SHIFT,J,swapwindow,d

# Move windows between monitors
bind=SUPER+SHIFT,comma,movewindow,mon:l
bind=SUPER+SHIFT,period,movewindow,mon:r

# Focus between monitors
bind=SUPER,comma,focusmonitor,l
bind=SUPER,period,focusmonitor,r

# Alternative: Move window to next/previous monitor (cycles)
bind=SUPER+SHIFT,bracketleft,movewindow,mon:-1
bind=SUPER+SHIFT,bracketright,movewindow,mon:+1

# =============================================================================
# RESIZE MODE (Super+R to enter, Escape to exit)
# =============================================================================
bind=SUPER,R,submap,resize

submap=resize
# Resize with arrow keys
binde=,right,resizeactive,40 0
binde=,left,resizeactive,-40 0
binde=,up,resizeactive,0 -40
binde=,down,resizeactive,0 40

# Resize with vim keys
binde=,l,resizeactive,40 0
binde=,h,resizeactive,-40 0
binde=,k,resizeactive,0 -40
binde=,j,resizeactive,0 40

# Fine resize with Shift
binde=SHIFT,right,resizeactive,10 0
binde=SHIFT,left,resizeactive,-10 0
binde=SHIFT,up,resizeactive,0 -10
binde=SHIFT,down,resizeactive,0 10

# Exit resize mode
bind=,escape,submap,reset
bind=,Return,submap,reset
submap=reset
